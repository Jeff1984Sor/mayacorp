{% extends 'base.html' %}
{% load static %}

{% block title %}Lançar Despesa | MayaCorp Fit{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto pb-24 px-4">
    
    <!-- HEADER: Identidade Studio Premium -->
    <header class="flex flex-col md:flex-row items-center gap-8 mb-12 px-2">
        <!-- Ícone em MARSALA -->
        <div class="w-20 h-20 bg-primary rounded-[28px] flex items-center justify-center text-white shadow-xl shadow-primary/30 border-2 border-white transition-transform hover:rotate-6">
            <i class="fas fa-file-invoice-dollar text-3xl"></i>
        </div>
        <div class="text-center md:text-left">
            <h1 class="text-4xl font-black text-slate-900 tracking-tighter uppercase">Lançar Despesa</h1>
            <p class="text-[11px] text-primary font-black uppercase tracking-[3px] mt-1">Gestão de Saídas e Custos Operacionais</p>
        </div>
    </header>

    <form method="POST" enctype="multipart/form-data" class="space-y-10 animate-in fade-in slide-in-from-bottom-6 duration-700">
        {% csrf_token %}
        
        <!-- CARD 1: O QUE E QUANTO (MÁXIMA NITIDEZ) -->
        <div class="bg-white rounded-[3rem] shadow-2xl shadow-slate-200/60 border border-slate-100 p-10 md:p-14 relative overflow-hidden">
            <!-- Detalhe decorativo de fundo -->
            <div class="absolute top-0 right-0 w-80 h-80 bg-primary/5 rounded-full -mr-32 -mt-32 blur-3xl"></div>
            
            <div class="flex items-center gap-4 mb-10 relative z-10">
                <div class="w-10 h-10 bg-primary rounded-xl flex items-center justify-center text-white shadow-lg shadow-primary/20">
                    <i class="fas fa-pen-to-square"></i>
                </div>
                <h3 class="text-xs font-black text-slate-900 uppercase tracking-[4px]">Dados do Lançamento</h3>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-12 gap-8 relative z-10">
                <!-- Descrição -->
                <div class="md:col-span-8">
                    <label class="label-custom">Descrição da Despesa</label>
                    {{ form.descricao }}
                </div>
                <!-- Valor em MARSALA (Foco total no dinheiro) -->
                <div class="md:col-span-4">
                    <label class="label-custom text-primary">Valor do Título (R$)</label>
                    <div class="relative group">
                        <span class="absolute left-6 top-1/2 -translate-y-1/2 text-primary font-black italic group-focus-within:scale-110 transition-transform">R$</span>
                        {{ form.valor }}
                    </div>
                </div>
            </div>
        </div>

        <!-- CARD 2: CLASSIFICAÇÃO (AZUL VIBRANTE) -->
        <div class="bg-white rounded-[3rem] shadow-2xl shadow-slate-200/60 border border-slate-100 p-10 md:p-14 relative overflow-hidden">
            <div class="absolute left-0 top-0 w-2 h-full bg-secondary"></div>
            
            <div class="flex items-center gap-4 mb-10">
                <div class="w-10 h-10 bg-secondary rounded-xl flex items-center justify-center text-white shadow-lg shadow-secondary/20">
                    <i class="fas fa-sitemap"></i>
                </div>
                <h3 class="text-xs font-black text-slate-900 uppercase tracking-[4px]">Classificação Contábil</h3>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div>
                    <label class="label-custom">Categoria</label>
                    {{ form.categoria }}
                </div>
                <div>
                    <label class="label-custom">Conta de Saída</label>
                    {{ form.conta }}
                </div>
                <div>
                    <label class="label-custom">Status do Pagamento</label>
                    {{ form.status }}
                </div>
                <div class="md:col-span-1 lg:col-span-2">
                    <label class="label-custom">Fornecedor / Favorecido</label>
                    {{ form.fornecedor }}
                </div>
                <div>
                    <label class="label-custom">Profissional Relacionado</label>
                    {{ form.profissional }}
                </div>
            </div>
        </div>

        <!-- CARD 3: VENCIMENTO E RECORRÊNCIA (AMARELO DESTAQUE) -->
        <div class="bg-white rounded-[3rem] shadow-2xl shadow-slate-200/60 border border-slate-100 p-10 md:p-14 border-l-[12px] border-l-primary relative">
            <h3 class="text-xs font-black text-primary uppercase tracking-[4px] mb-10 flex items-center gap-4">
                <div class="w-10 h-10 bg-slate-900 rounded-xl flex items-center justify-center text-white">
                    <i class="fas fa-calendar-day"></i>
                </div>
                Prazos e Agendamentos
            </h3>

            <div class="grid grid-cols-1 md:grid-cols-12 gap-10">
                <div class="md:col-span-4">
                    <label class="label-custom">Data de Vencimento</label>
                    {{ form.data_vencimento }}
                </div>

                <!-- Toggle de Recorrência Inteligente -->
                <div class="md:col-span-8 flex items-center bg-slate-50 p-6 rounded-[2rem] border-2 border-slate-200 group transition-all hover:border-accent">
                    <div class="flex items-center gap-5 w-full">
                        <div class="scale-150 ml-2">
                            <input type="checkbox" name="repetir" id="id_repetir" class="checkbox checkbox-secondary border-2" onchange="toggleRecorrencia()">
                        </div>
                        <div>
                            <p class="text-sm font-black text-slate-900 uppercase tracking-tight">Repetir esta conta?</p>
                            <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Habilitar lançamentos automáticos futuros</p>
                        </div>
                        <i class="fas fa-arrows-rotate ml-auto text-slate-200 text-2xl group-hover:text-accent transition-colors"></i>
                    </div>
                </div>
            </div>

            <!-- SEÇÃO EXPANSÍVEL (Via JS) -->
            <div id="secao_recorrencia" class="hidden grid grid-cols-1 md:grid-cols-2 gap-8 mt-10 pt-10 border-t-2 border-dashed border-slate-200 animate-in slide-in-from-top-4">
                <div>
                    <label class="label-custom text-accent">Frequência da Repetição</label>
                    {{ form.frequencia }}
                </div>
                <div>
                    <label class="label-custom text-accent">Quantidade de Parcelas</label>
                    {{ form.qtd_repeticoes }}
                </div>
            </div>
        </div>

        <!-- CARD 4: ANEXOS (ESTILO INDUSTRIAL) -->
        <div class="bg-slate-900 rounded-[3rem] p-10 md:p-14 shadow-2xl relative overflow-hidden">
            <div class="absolute right-0 bottom-0 w-32 h-32 bg-white/5 rounded-full -mr-16 -mb-16"></div>
            <h3 class="text-xs font-black text-white uppercase tracking-[4px] mb-10 flex items-center gap-4">
                <i class="fas fa-paperclip text-accent"></i> Comprovantes e Documentos
            </h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                <div class="bg-white/5 p-8 rounded-[2rem] border-2 border-white/10 group hover:border-primary transition-all">
                    <label class="text-[11px] font-black text-primary uppercase tracking-[2px] mb-4 block"><i class="fas fa-barcode mr-2"></i> Boleto / Fatura</label>
                    {{ form.arquivo_boleto }}
                </div>
                <div class="bg-white/5 p-8 rounded-[2rem] border-2 border-white/10 group hover:border-emerald-500 transition-all">
                    <label class="text-[11px] font-black text-emerald-400 uppercase tracking-[2px] mb-4 block"><i class="fas fa-receipt mr-2"></i> Comprovante de Baixa</label>
                    {{ form.arquivo_comprovante }}
                </div>
            </div>
        </div>

        <!-- AÇÕES FINAIS (AZUL VIBRANTE) -->
        <div class="flex flex-col md:flex-row items-center gap-6">
            <button type="submit" class="btn bg-secondary border-none text-white w-full md:flex-1 h-20 rounded-[2rem] shadow-2xl shadow-secondary/30 font-black uppercase tracking-[3px] text-lg hover:bg-blue-800 hover:scale-[1.02] active:scale-95 transition-all group">
                <i class="fas fa-save text-xl mr-3 group-hover:animate-pulse"></i> SALVAR LANÇAMENTO
            </button>
            <a href="{% url 'contas_pagar' %}" class="btn btn-ghost text-slate-400 w-full md:w-auto h-20 px-12 rounded-[2rem] font-black uppercase tracking-widest text-xs hover:bg-slate-100 transition-all">
                DESCARTAR
            </a>
        </div>
    </form>
</div>

<style>
    /* Estilos Customizados para Nitidez Studio MayaCorp */
    
    .label-custom { @apply text-[11px] font-black text-slate-500 uppercase tracking-[2px] mb-3 block ml-2 !important; }
    
    /* Inputs de Alta Nitidez */
    input:not([type="checkbox"]), select, .textinput { 
        @apply w-full bg-white border-2 border-slate-200 rounded-2xl px-6 h-16 focus:border-primary focus:ring-0 focus:outline-none transition-all text-slate-900 font-black text-sm placeholder:text-slate-300 shadow-sm !important; 
    }
    
    /* Destaque para o Valor */
    input[name="valor"] {
        @apply pl-16 text-2xl tracking-tighter text-primary !important;
    }

    /* Inputs de Arquivo Premium */
    input[type="file"] {
        @apply h-auto py-4 bg-white/10 border-none text-white text-xs font-bold cursor-pointer !important;
    }
</style>

<script>
    function toggleRecorrencia() {
        const checkbox = document.getElementById('id_repetir');
        const secao = document.getElementById('secao_recorrencia');
        
        if (checkbox.checked) {
            secao.classList.remove('hidden');
        } else {
            secao.classList.add('hidden');
        }
    }
    // Inicialização
    document.addEventListener('DOMContentLoaded', toggleRecorrencia);
</script>
{% endblock %}