{% load static %}
{% load core_extras %}

<!-- SIDEBAR CONTAINER: Focada apenas em Navegação e Identidade Visual -->
<div class="flex flex-col w-64 h-full bg-white border-r border-slate-100 p-4 transition-all duration-300">
    
    <!-- LOGO: Identidade do Estúdio -->
    <a href="/" class="flex items-center gap-3 px-2 mb-10 no-underline group">
        <div class="w-10 h-10 bg-mint-green flex items-center justify-center rounded-2xl shadow-lg shadow-mint-green/30 group-hover:scale-110 transition-transform">
            <i class="fas fa-dumbbell text-emerald-700 fa-lg"></i>
        </div>
        <div class="flex flex-col">
            <span class="text-lg font-black text-slate-800 leading-tight tracking-tight">MayaCorp</span>
            <span class="text-[9px] font-black text-mint-green uppercase tracking-[3px]">Estúdio Fit</span>
        </div>
    </a>

    <!-- NAVEGAÇÃO PRINCIPAL -->
    <nav class="flex-1 space-y-1 overflow-y-auto custom-scroll pr-1">
        
        {% if user.is_authenticated %}
            
            <!-- ITEM DASHBOARD -->
            <a href="{% url 'home' %}" 
               class="flex items-center gap-3 px-4 py-3 rounded-2xl transition-all duration-200 group
               {% if request.path == '/' %} bg-serene-blue/15 text-serene-blue font-black {% else %} text-slate-500 hover:bg-slate-50 hover:text-slate-800 {% endif %}">
                <i class="fas fa-tachometer-alt w-5 text-center text-xs"></i>
                <span class="text-xs uppercase tracking-widest font-bold">Início</span>
            </a>

            <!-- CATEGORIA: GESTÃO FIT -->
            {% if 'suite_pilates' in perms_produtos or user.is_superuser %}
                <div class="pt-8 pb-3 px-4">
                    <span class="text-[9px] font-black text-slate-300 uppercase tracking-[3px]">Gestão Operacional</span>
                </div>
                
                <!-- AGENDA -->
                <details class="group [&_summary::-webkit-details-marker]:hidden" {% if 'agenda' in request.path %}open{% endif %}>
                    <summary class="flex items-center justify-between px-4 py-3 text-slate-500 rounded-2xl cursor-pointer hover:bg-slate-50 hover:text-slate-800 transition-all">
                        <div class="flex items-center gap-3">
                            <div class="w-7 h-7 rounded-xl bg-orange-100 flex items-center justify-center">
                                <i class="fas fa-calendar-alt text-orange-500 text-[10px]"></i>
                            </div>
                            <span class="text-xs font-bold uppercase tracking-wider">Agenda</span>
                        </div>
                        <i class="fas fa-chevron-right text-[8px] transition-transform group-open:rotate-90"></i>
                    </summary>
                    <div class="mt-1 ml-9 space-y-1 border-l border-slate-100">
                        <a href="{% url 'calendario_semanal' %}" class="block px-4 py-2 text-[11px] font-bold text-slate-400 hover:text-serene-blue transition-colors">Calendário Semanal</a>
                        <a href="{% url 'relatorio_frequencia' %}" class="block px-4 py-2 text-[11px] font-bold text-slate-400 hover:text-serene-blue transition-colors">Frequência Alunos</a>
                    </div>
                </details>

                <!-- FINANCEIRO -->
                <details class="group [&_summary::-webkit-details-marker]:hidden" {% if 'financeiro' in request.path %}open{% endif %}>
                    <summary class="flex items-center justify-between px-4 py-3 text-slate-500 rounded-2xl cursor-pointer hover:bg-slate-50 hover:text-slate-800 transition-all">
                        <div class="flex items-center gap-3">
                            <div class="w-7 h-7 rounded-xl bg-soft-lavender/40 flex items-center justify-center">
                                <i class="fas fa-dollar-sign text-purple-600 text-[10px]"></i>
                            </div>
                            <span class="text-xs font-bold uppercase tracking-wider">Financeiro</span>
                        </div>
                        <i class="fas fa-chevron-right text-[8px] transition-transform group-open:rotate-90"></i>
                    </summary>
                    <div class="mt-1 ml-9 space-y-1 border-l border-slate-100">
                        <a href="{% url 'contas_receber' %}" class="block px-4 py-2 text-[11px] font-bold text-slate-400 hover:text-purple-600 transition-colors">Contas a Receber</a>
                        <a href="{% url 'contas_pagar' %}" class="block px-4 py-2 text-[11px] font-bold text-slate-400 hover:text-purple-600 transition-colors">Contas a Pagar</a>
                        <a href="{% url 'conta_list' %}" class="block px-4 py-2 text-[11px] font-bold text-slate-400 hover:text-purple-600 transition-colors">Bancos e Caixas</a>
                    </div>
                </details>
                
                <!-- CADASTROS -->
                <details class="group [&_summary::-webkit-details-marker]:hidden" {% if 'cadastros' in request.path or 'contratos' in request.path %}open{% endif %}>
                    <summary class="flex items-center justify-between px-4 py-3 text-slate-500 rounded-2xl cursor-pointer hover:bg-slate-50 hover:text-slate-800 transition-all">
                        <div class="flex items-center gap-3">
                            <div class="w-7 h-7 rounded-xl bg-blue-100 flex items-center justify-center">
                                <i class="fas fa-folder text-blue-600 text-[10px]"></i>
                            </div>
                            <span class="text-xs font-bold uppercase tracking-wider">Cadastros</span>
                        </div>
                        <i class="fas fa-chevron-right text-[8px] transition-transform group-open:rotate-90"></i>
                    </summary>
                    <div class="mt-1 ml-9 space-y-1 border-l border-slate-100">
                        <a href="{% url 'aluno_list' %}" class="block px-4 py-2 text-[11px] font-bold text-slate-400 hover:text-blue-600 transition-colors">Lista de Alunos</a>
                        <a href="{% url 'profissional_list' %}" class="block px-4 py-2 text-[11px] font-bold text-slate-400 hover:text-blue-600 transition-colors">Profissionais</a>
                        <a href="{% url 'plano_list' %}" class="block px-4 py-2 text-[11px] font-bold text-slate-400 hover:text-blue-600 transition-colors">Planos e Preços</a>
                    </div>
                </details>
            {% endif %}

            <!-- CATEGORIA: FERRAMENTAS -->
            {% if user|tem_acesso:"gerador-pdf" %}
                <div class="pt-8 pb-3 px-4">
                    <span class="text-[9px] font-black text-slate-300 uppercase tracking-[3px]">Inteligência</span>
                </div>
                <a href="{% url 'pdf_home' %}" class="flex items-center gap-3 px-4 py-3 text-slate-500 rounded-2xl hover:bg-red-50 hover:text-red-600 transition-all group/pdf">
                    <div class="w-7 h-7 rounded-xl bg-red-100 flex items-center justify-center group-hover/pdf:bg-red-500 group-hover/pdf:text-white transition-all">
                        <i class="fas fa-robot text-[10px]"></i>
                    </div>
                    <span class="text-xs font-bold uppercase tracking-wider">Conciliação IA</span>
                </a>
            {% endif %}

        {% endif %}
    </nav>
    
    <!-- RODAPÉ DA SIDEBAR: Somente versão e suporte -->
    <div class="mt-auto pt-6 border-t border-slate-50 text-center">
        <div class="flex items-center justify-center gap-2 mb-2 opacity-50">
            <div class="w-1.5 h-1.5 rounded-full bg-slate-400"></div>
            <span class="text-[8px] font-black text-slate-400 uppercase tracking-[3px]">Cloud Active</span>
        </div>
        <div class="text-slate-300 text-[9px] font-black tracking-[5px]">MAYA V2.0</div>
    </div>
</div>