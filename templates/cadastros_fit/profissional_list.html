{% extends 'base.html' %}
{% load static %}

{% block title %}Equipe de Profissionais | MayaCorp Fit{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto pb-24 px-4">

<!-- ================= HEADER ================= -->
<header class="flex flex-col lg:flex-row justify-between items-start lg:items-center mb-14 gap-10">
    <div class="flex items-center gap-6">
        <div class="w-16 h-16 bg-primary rounded-[22px] flex items-center justify-center text-white shadow-xl shadow-primary/30 border-2 border-white">
            <i class="fas fa-user-tie text-2xl"></i>
        </div>
        <div>
            <h1 class="text-4xl font-black text-slate-900 tracking-tighter">Equipe Profissional</h1>
            <p class="text-[11px] text-primary font-black uppercase tracking-[4px] mt-1">
                Gestão de instrutores e especialistas
            </p>
        </div>
    </div>

    <!-- BOTÃO MODAL -->
    <button onclick="modal_profissional.showModal()"
            class="btn bg-secondary border-none text-white rounded-2xl px-10 h-16 shadow-2xl shadow-secondary/30 hover:bg-blue-800 hover:scale-105 transition-all font-black uppercase tracking-widest text-xs">
        <i class="fas fa-plus-circle mr-2 text-lg"></i>
        Novo Profissional
    </button>
</header>

<!-- ================= KPIs ================= -->
<section class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-16">

    <div class="bg-white rounded-[2rem] p-6 shadow-sm border border-slate-100">
        <p class="text-[10px] font-black uppercase tracking-widest text-slate-400 mb-2">Total</p>
        <h3 class="text-3xl font-black text-slate-900">{{ profissionais|length }}</h3>
    </div>

    <div class="bg-white rounded-[2rem] p-6 shadow-sm border border-slate-100">
        <p class="text-[10px] font-black uppercase tracking-widest text-slate-400 mb-2">Ativos</p>
        <h3 class="text-3xl font-black text-emerald-600">{{ ativos_count }}</h3>
    </div>

    <div class="bg-white rounded-[2rem] p-6 shadow-sm border border-slate-100">
        <p class="text-[10px] font-black uppercase tracking-widest text-slate-400 mb-2">Inativos</p>
        <h3 class="text-3xl font-black text-primary">{{ inativos_count }}</h3>
    </div>

    <div class="bg-white rounded-[2rem] p-6 shadow-sm border border-slate-100">
        <p class="text-[10px] font-black uppercase tracking-widest text-slate-400 mb-2">Equipe</p>
        <h3 class="text-xl font-black text-slate-700 uppercase">Studio</h3>
    </div>

</section>

<!-- ================= FILTRO ================= -->
<div class="flex items-center gap-4 mb-10">
    <span class="text-[10px] font-black uppercase tracking-widest text-slate-400">Filtrar:</span>
    <select onchange="filtrarStatus(this.value)"
            class="bg-white border border-slate-200 rounded-xl px-4 py-2 text-xs font-black uppercase text-slate-700">
        <option value="all">Todos</option>
        <option value="ativo">Ativos</option>
        <option value="inativo">Inativos</option>
    </select>
</div>

<!-- ================= GRID ================= -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
{% for prof in profissionais %}
<div class="prof-card {% if prof.ativo %}ativo{% else %}inativo{% endif %} group bg-white rounded-[3rem] shadow-2xl shadow-slate-200/60 border border-slate-100 p-10 relative transition-all hover:-translate-y-3">

    <div class="absolute top-0 right-0 w-40 h-40 -mr-20 -mt-20 rounded-full opacity-20 blur-2xl"
         style="background-color: {{ prof.cor_agenda|default:'#802422' }};"></div>

    <div class="relative text-center">

        <div class="w-24 h-24 mx-auto rounded-[2.5rem] mb-8 flex items-center justify-center text-white text-3xl font-black shadow-xl"
             style="background-color: {{ prof.cor_agenda|default:'#1e293b' }};">
            {{ prof.nome|slice:":1" }}
        </div>

        <h3 class="text-2xl font-black text-slate-900 mb-1 uppercase tracking-tighter">
            {{ prof.nome }}
        </h3>

        <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-6">
            CREFITO {{ prof.crefito|default:"—" }}
        </p>

        <div class="bg-slate-50 rounded-[2rem] p-6 mb-8 border border-slate-100">
            <div class="flex justify-between items-center">
                <div>
                    <span class="text-[9px] font-black uppercase tracking-widest text-primary">Custo/Aula</span>
                    <p class="text-xl font-black text-slate-900">
                        R$ {{ prof.valor_hora_aula }}
                    </p>
                </div>

                {% if prof.ativo %}
                    <span class="text-[10px] font-black uppercase bg-emerald-100 text-emerald-700 px-4 py-1 rounded-full">
                        Ativo
                    </span>
                {% else %}
                    <span class="text-[10px] font-black uppercase bg-red-100 text-primary px-4 py-1 rounded-full">
                        Inativo
                    </span>
                {% endif %}
            </div>
        </div>

        <div class="flex gap-4">
            <a href="{% url 'profissional_update' prof.pk %}"
               class="btn flex-1 bg-white border-2 border-slate-100 hover:border-secondary rounded-2xl text-slate-600 font-black uppercase text-[10px] h-14">
                Editar
            </a>

            <a href="{% url 'calendario_semanal' %}?prof_id={{ prof.user.id }}"
               class="btn btn-square bg-secondary hover:bg-blue-800 text-white border-none rounded-2xl w-14 h-14 shadow-lg">
                <i class="fas fa-calendar-day"></i>
            </a>
        </div>

    </div>
</div>
{% endfor %}
</div>

</div>

<!-- ================= MODAL NOVO PROFISSIONAL ================= -->
<dialog id="modal_profissional" class="modal">
    <div class="modal-box max-w-4xl bg-slate-900 text-white rounded-[2.5rem] shadow-2xl p-10">

        <div class="flex items-center justify-between mb-10">
            <div>
                <h2 class="text-3xl font-black tracking-tight">Novo Profissional</h2>
                <p class="text-xs uppercase tracking-[0.3em] text-white/60 mt-2">
                    Cadastro rápido
                </p>
            </div>

            <button onclick="modal_profissional.close()"
                    class="btn btn-ghost btn-circle text-white/60 hover:text-white">
                ✕
            </button>
        </div>

        <form method="post" action="{% url 'profissional_create' %}" class="space-y-10">
            {% csrf_token %}

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <input name="username" class="input" placeholder="Usuário" required>
                <input type="password" name="password" class="input" placeholder="Senha" required>
                <select name="perfil" class="select">
                    <option value="INSTRUTOR">Instrutor</option>
                    <option value="ADMIN">Administrador</option>
                </select>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <input name="nome" class="input" placeholder="Nome completo" required>
                <input name="cpf" class="input" placeholder="CPF" required>
                <input type="email" name="email" class="input" placeholder="E-mail">
                <input name="telefone" class="input" placeholder="Telefone">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <input name="crefito" class="input" placeholder="CREFITO">
                <input type="number" step="0.01" name="valor_hora_aula" class="input" value="0.00">
                <input type="color" name="cor_agenda" value="#802422"
                       class="h-14 w-full rounded-xl border border-white/20 bg-transparent">
            </div>

            <div class="flex justify-between pt-6">
                <button type="button"
                        onclick="modal_profissional.close()"
                        class="btn btn-ghost text-white/60 uppercase tracking-widest text-xs">
                    Cancelar
                </button>

                <button type="submit"
                        class="btn btn-primary px-16 h-14 uppercase tracking-widest font-black">
                    Salvar Profissional
                </button>
            </div>
        </form>
    </div>

    <form method="dialog" class="modal-backdrop bg-black/70 backdrop-blur-sm">
        <button>fechar</button>
    </form>
</dialog>

<script>
function filtrarStatus(status) {
    document.querySelectorAll('.prof-card').forEach(card => {
        card.style.display =
            status === 'all' || card.classList.contains(status)
                ? ''
                : 'none';
    });
}
</script>
{% endblock %}
