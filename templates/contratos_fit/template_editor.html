{% extends 'base.html' %}
{% load static %}

{% block title %}Editor de Contrato | MayaCorp Fit{% endblock %}

{% block content %}
<script src="https://cdn.ckeditor.com/4.22.1/standard/ckeditor.js"></script>

<div class="max-w-7xl mx-auto pb-24 px-4">

<!-- ================= HEADER ================= -->
<header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-12 gap-8">
    <div class="flex items-center gap-6">
        <div class="w-14 h-14 bg-primary rounded-2xl flex items-center justify-center text-white shadow-lg">
            <i class="fas fa-file-contract text-xl"></i>
        </div>
        <div>
            <h1 class="text-3xl font-black text-slate-900 tracking-tight uppercase">
                Editor de Contrato
            </h1>
            <p class="text-[11px] text-primary font-black uppercase tracking-[3px] mt-1">
                Documento jurídico dinâmico
            </p>
        </div>
    </div>

    <a href="{% url 'template_list' %}"
       class="btn bg-slate-100 border-none rounded-xl px-6 h-12 font-black text-slate-600 hover:bg-slate-200">
        <i class="fas fa-arrow-left mr-2"></i> Voltar
    </a>
</header>

<form method="post">
{% csrf_token %}

<div class="flex gap-8">

    <!-- ================= CONTEÚDO PRINCIPAL ================= -->
    <div class="flex-1 space-y-8 min-w-0">

        <!-- NOME -->
        <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-slate-100">
            <label class="block text-[10px] font-black uppercase tracking-widest text-slate-400 mb-2">
                Identificação do modelo
            </label>

            <input type="text"
                   name="nome"
                   value="{{ form.instance.nome|default:'' }}"
                   placeholder="Ex: Contrato Plano Mensal – Pilates"
                   required
                   class="input w-full bg-slate-50 border-none rounded-xl font-black text-base">
        </div>

        <!-- EDITOR -->
        <div class="bg-white rounded-[2rem] shadow-sm border border-slate-100 overflow-hidden">

            <div class="flex justify-between items-center px-6 py-4 bg-slate-900 text-white">
                <span class="text-[10px] font-black uppercase tracking-widest">
                    Conteúdo do contrato
                </span>

                <label class="flex items-center gap-3 text-[10px] font-black uppercase">
                    Ativo
                    <input type="checkbox" name="ativo" class="toggle toggle-primary"
                           {% if form.instance.ativo %}checked{% endif %}>
                </label>
            </div>

            <div class="p-4">
                <textarea name="texto_html" id="editorContrato">
{{ form.instance.texto_html }}
                </textarea>
            </div>
        </div>

        <!-- SALVAR -->
        <div class="bg-slate-900 rounded-[2rem] p-6 flex justify-between items-center">
            <p class="text-[10px] text-slate-400 font-black uppercase tracking-widest">
                Compatível com impressão e assinatura digital
            </p>

            <button type="submit"
                    class="btn bg-secondary hover:bg-blue-800 text-white rounded-xl px-12 h-14
                           font-black uppercase tracking-widest shadow-lg">
                <i class="fas fa-save mr-2"></i> Salvar
            </button>
        </div>

    </div>

    <!-- ================= SIDEBAR ================= -->
    <aside class="w-[320px] shrink-0 hidden lg:block">
        <div class="bg-white rounded-[2rem] shadow-sm border border-slate-100 sticky top-28">

            <div class="px-6 py-4 bg-secondary text-white rounded-t-[2rem]">
                <h3 class="text-[10px] font-black uppercase tracking-widest flex items-center gap-2">
                    <i class="fas fa-magic text-accent"></i>
                    Variáveis dinâmicas
                </h3>
            </div>

            <div class="p-4 space-y-2 max-h-[60vh] overflow-y-auto">
                {% for var in variaveis %}
                <button type="button"
                        ondblclick="inserirVariavel('{{ var.codigo }}')"
                        class="w-full text-left p-3 rounded-xl border border-slate-100
                               hover:border-secondary hover:bg-secondary/5 transition">
                    <div class="text-[10px] font-black uppercase text-slate-700">
                        {{ var.desc }}
                    </div>
                    <code class="block mt-1 text-[9px] bg-red-50 text-primary px-2 py-1 rounded w-fit">
                        {{ var.codigo }}
                    </code>
                </button>
                {% endfor %}
            </div>

            <div class="p-4 bg-slate-50 border-t border-slate-100 rounded-b-[2rem]">
                <p class="text-[9px] text-slate-400 font-bold uppercase tracking-widest">
                    Use imagens apenas para logomarca
                </p>
            </div>
        </div>
    </aside>

</div>
</form>
</div>

<style>
.cke_chrome { border: none !important; }
.cke_top {
    background: #0f172a !important;
    padding: 10px !important;
}
.cke_button_icon { filter: invert(1); }
</style>

<script>
CKEDITOR.replace('editorContrato', {
    height: 520,
    resize_enabled: false,
    removePlugins: 'elementspath',
    toolbar: [
        { name: 'basicstyles', items: ['Bold', 'Italic', 'Underline'] },
        { name: 'paragraph', items: ['NumberedList', 'BulletedList', '-', 'JustifyLeft', 'JustifyCenter', 'JustifyBlock'] },
        { name: 'insert', items: ['Image', 'Table'] },
        { name: 'document', items: ['Source', 'Preview', 'Print'] }
    ]
});

function inserirVariavel(texto) {
    CKEDITOR.instances.editorContrato.insertText(texto);
}
</script>
{% endblock %}
