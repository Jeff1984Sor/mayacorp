{% extends 'base.html' %}
{% load static %}

{% block title %}Editor de Contrato | MayaCorp Fit{% endblock %}

{% block content %}
<script src="https://cdn.ckeditor.com/4.22.1/standard/ckeditor.js"></script>

<div class="max-w-7xl mx-auto pb-24 px-4">

    <!-- HEADER -->
    <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-12 gap-8 px-2">
        <div class="flex items-center gap-6">
            <div class="w-16 h-16 bg-primary rounded-[22px] flex items-center justify-center text-white shadow-xl border-2 border-white">
                <i class="fas fa-file-contract text-2xl"></i>
            </div>
            <div>
                <h1 class="text-4xl font-black text-slate-900 tracking-tighter uppercase">
                    Editor de Contrato
                </h1>
                <p class="text-[11px] text-primary font-black uppercase tracking-[3px] mt-1">
                    Documento Jurídico Dinâmico
                </p>
            </div>
        </div>

        <a href="{% url 'template_list' %}"
           class="btn bg-white border-2 border-slate-200 rounded-2xl px-8 h-14 font-black text-slate-600 hover:bg-slate-50">
            <i class="fas fa-arrow-left mr-2"></i> VOLTAR
        </a>
    </header>

    <form method="post">
        {% csrf_token %}

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-10">

            <!-- COLUNA PRINCIPAL -->
            <div class="lg:col-span-9 space-y-10">

                <!-- NOME -->
                <div class="bg-white p-10 rounded-[2.5rem] shadow-xl border border-slate-100 relative">
                    <div class="absolute left-0 top-0 w-1.5 h-full bg-primary"></div>

                    <label class="block text-[11px] font-black uppercase tracking-[2px] text-slate-500 mb-4 ml-2">
                        Identificação do Modelo
                    </label>

                    <input type="text"
                           name="nome"
                           value="{{ form.instance.nome|default:'' }}"
                           placeholder="EX: CONTRATO DE PLANO MENSAL – PILATES"
                           required
                           class="w-full h-16 px-8 rounded-2xl bg-slate-50 border-2 border-slate-200 font-black text-lg focus:border-primary focus:outline-none">
                </div>

                <!-- EDITOR -->
                <div class="bg-white rounded-[3rem] shadow-xl border border-slate-100 overflow-hidden">

                    <div class="p-8 bg-slate-50 flex justify-between items-center border-b border-slate-100">
                        <h3 class="text-xs font-black uppercase tracking-[3px] text-slate-900">
                            Conteúdo do Contrato
                        </h3>

                        <div class="flex items-center gap-4">
                            <span class="text-[10px] font-black uppercase tracking-widest text-slate-400">
                                Modelo Ativo
                            </span>
                            <input type="checkbox" name="ativo" class="toggle toggle-primary"
                                   {% if form.instance.ativo %}checked{% endif %}>
                        </div>
                    </div>

                    <div class="p-4">
                        <textarea name="texto_html" id="editorContrato">
                            {{ form.instance.texto_html }}
                        </textarea>
                    </div>
                </div>

                <!-- SALVAR -->
                <div class="bg-slate-900 rounded-[2.5rem] p-8 flex justify-between items-center">
                    <p class="text-[10px] text-slate-400 font-black uppercase tracking-widest">
                        HTML compatível com impressão e assinatura digital
                    </p>

                    <button type="submit"
                            class="btn bg-secondary hover:bg-blue-800 text-white rounded-2xl px-16 h-20 font-black uppercase tracking-widest shadow-xl">
                        <i class="fas fa-save mr-3"></i> SALVAR MODELO
                    </button>
                </div>
            </div>

            <!-- VARIÁVEIS -->
            <aside class="lg:col-span-3">
                <div class="bg-white rounded-[2.5rem] shadow-xl border border-slate-100 sticky top-28">

                    <div class="p-8 bg-secondary text-white flex items-center gap-3">
                        <i class="fas fa-magic text-accent"></i>
                        <h3 class="text-[11px] font-black uppercase tracking-[3px]">
                            Variáveis Dinâmicas
                        </h3>
                    </div>

                    <div class="p-6 space-y-2 max-h-[60vh] overflow-y-auto">
                        {% for var in variaveis %}
                            <button type="button"
                                    ondblclick="inserirVariavel('{{ var.codigo }}')"
                                    class="w-full text-left p-4 rounded-xl border border-slate-100 hover:border-secondary hover:bg-secondary/5 transition">
                                <span class="text-xs font-black text-slate-800 uppercase">
                                    {{ var.desc }}
                                </span>
                                <code class="block mt-2 text-[10px] bg-red-50 text-primary px-2 py-1 rounded w-fit">
                                    {{ var.codigo }}
                                </code>
                            </button>
                        {% endfor %}
                    </div>

                    <div class="p-6 bg-slate-50 border-t border-slate-100">
                        <p class="text-[10px] text-slate-500 font-bold uppercase tracking-tight">
                            Use imagens apenas para logomarca.
                        </p>
                    </div>
                </div>
            </aside>
        </div>
    </form>
</div>

<style>
    .cke_chrome { border: none !important; }
    .cke_top {
        background: #0f172a !important;
        padding: 14px !important;
    }
    .cke_button_icon { filter: invert(1); }
</style>

<script>
    CKEDITOR.replace('editorContrato', {
        height: 620,
        removePlugins: 'elementspath',
        resize_enabled: false,
        toolbar: [
            { name: 'document', items: ['Source', 'Preview', 'Print'] },
            { name: 'basicstyles', items: ['Bold', 'Italic', 'Underline'] },
            { name: 'paragraph', items: ['NumberedList', 'BulletedList', '-', 'JustifyLeft', 'JustifyCenter', 'JustifyBlock'] },
            { name: 'insert', items: ['Image', 'Table', 'HorizontalRule'] },
            { name: 'styles', items: ['Format', 'FontSize'] }
        ],
        fontSize_sizes: '9/9pt;10/10pt;11/11pt;12/12pt;14/14pt;16/16pt;18/18pt'
    });

    function inserirVariavel(texto) {
        CKEDITOR.instances.editorContrato.insertText(texto);
    }
</script>
{% endblock %}
